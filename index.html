<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Spider Sense</title>
<style>
body {
  margin: 0;
  background: black;
  color: white;
  font-size: 22px;
  text-align: center;
}
video {
  width: 100%;
  height: auto;
}
</style>
</head>
<body>

<h1>Spider Sense Active</h1>
<p id="status">Starting back camera...</p>
<video id="camera" autoplay playsinline></video>

<script>
const video = document.getElementById("camera");
const statusText = document.getElementById("status");

navigator.mediaDevices.getUserMedia({
  video: { facingMode: { exact: "environment" } }
})
.then(stream => {
  video.srcObject = stream;
  statusText.innerText = "Back camera active. Monitoring distance.";
  startDetection();
})
.catch(err => {
  statusText.innerText = "Back camera not available.";
});

let lastFrame = null;

function startDetection() {
  const canvas = document.createElement("canvas");
  const ctx = canvas.getContext("2d");

  setInterval(() => {
    if (video.videoWidth === 0) return;

    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;
    ctx.drawImage(video, 0, 0);

    const currentFrame = ctx.getImageData(0, 0, canvas.width, canvas.height);

    if (lastFrame) {
      let totalDiff = 0;

      // Sample pixels for speed
      for (let i = 0; i < currentFrame.data.length; i += 40) {
        totalDiff += Math.abs(currentFrame.data[i] - lastFrame.data[i]);
      }

      // WALL / CLOSE OBJECT THRESHOLD
      if (totalDiff > 3000000) {
        warnUser();
      }
    }

    lastFrame = currentFrame;
  }, 300);
}

function warnUser() {
  navigator.vibrate([100, 50, 100]);

  const beep = new Audio("data:audio/wav;base64,UklGRigAAABXQVZFZm10IBAAAAABAAEAESsAACJWAAACABAAZGF0YQAAAAA=");
  beep.play();
}
</script>

</body>
</html>
