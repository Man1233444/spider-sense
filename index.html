<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Spider Sense VR</title>
<style>
html, body {
  margin: 0;
  padding: 0;
  background: black;
  overflow: hidden;
  width: 100%;
  height: 100%;
}

#container {
  display: flex;
  width: 100vw;
  height: 100vh;
}

.eye {
  width: 45vw;
  height: 100vh;
}

#gap {
  width: 10vw; /* MIDDLE SPACE FOR VR */
  background: black;
}

video {
  width: 100%;
  height: 100%;
  object-fit: cover;
}
</style>
</head>
<body>

<div id="container">
  <video id="left" class="eye" autoplay playsinline></video>
  <div id="gap"></div>
  <video id="right" class="eye" autoplay playsinline></video>
</div>

<script>
// FULLSCREEN ON TAP
document.body.addEventListener("click", () => {
  if (document.documentElement.requestFullscreen) {
    document.documentElement.requestFullscreen();
  }
}, { once: true });

const left = document.getElementById("left");
const right = document.getElementById("right");

// BACK CAMERA
navigator.mediaDevices.getUserMedia({
  video: { facingMode: { exact: "environment" } }
})
.then(stream => {
  left.srcObject = stream;
  right.srcObject = stream;
  startDetection();
});

let lastFrame = null;

function startDetection() {
  const canvas = document.createElement("canvas");
  const ctx = canvas.getContext("2d");

  setInterval(() => {
    if (left.videoWidth === 0) return;

    canvas.width = left.videoWidth;
    canvas.height = left.videoHeight;
    ctx.drawImage(left, 0, 0);

    const frame = ctx.getImageData(0, 0, canvas.width, canvas.height);

    if (lastFrame) {
      let diff = 0;

      // Sample pixels
      for (let i = 0; i < frame.data.length; i += 40) {
        diff += Math.abs(frame.data[i] - lastFrame.data[i]);
      }

      if (diff > 800000) {
        let strength = Math.min(Math.floor((diff - 800000) / 400000), 6);
        let pattern = [];

        for (let i = 0; i < strength; i++) {
          pattern.push(120, 60);
        }

        navigator.vibrate(pattern);
      }
    }

    lastFrame = frame;
  }, 250);
}
</script>

</body>
</html>
