<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Wrist Aim Ray</title>

<script src="https://cdn.jsdelivr.net/npm/@mediapipe/pose/pose.js"></script>

<style>
html, body {
  margin: 0;
  width: 100%;
  height: 100%;
  background: black;
  overflow: hidden;
}

video, canvas {
  position: absolute;
  width: 100%;
  height: 100%;
  object-fit: cover;
}

#start {
  position: fixed;
  inset: 0;
  background: black;
  color: white;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 36px;
  z-index: 10;
}
</style>
</head>
<body>

<video id="video" autoplay playsinline></video>
<canvas id="canvas"></canvas>
<div id="start">TAP TO START</div>

<script>
const video = document.getElementById("video");
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
const start = document.getElementById("start");

canvas.width = innerWidth;
canvas.height = innerHeight;

start.onclick = async () => {
  await document.documentElement.requestFullscreen?.();
  start.remove();
  startCamera();
};

async function startCamera() {
  const stream = await navigator.mediaDevices.getUserMedia({
    video: { facingMode: "environment" },
    audio: false
  });
  video.srcObject = stream;

  const pose = new Pose({
    locateFile: f => `https://cdn.jsdelivr.net/npm/@mediapipe/pose/${f}`
  });

  pose.setOptions({
    smoothLandmarks: true,
    minDetectionConfidence: 0.6,
    minTrackingConfidence: 0.6
  });

  pose.onResults(draw);

  const loop = async () => {
    if (video.readyState >= 2) await pose.send({ image: video });
    requestAnimationFrame(loop);
  };
  loop();
}

function draw(results) {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  if (!results.poseLandmarks) return;

  // RIGHT ARM ONLY
  const elbow = results.poseLandmarks[14];
  const wrist = results.poseLandmarks[16];
  if (!elbow || !wrist) return;

  const ex = elbow.x * canvas.width;
  const ey = elbow.y * canvas.height;
  const wx = wrist.x * canvas.width;
  const wy = wrist.y * canvas.height;

  // Direction = elbow â†’ wrist
  let dx = wx - ex;
  let dy = wy - ey;

  const len = Math.hypot(dx, dy);
  if (len < 10) return;

  dx /= len;
  dy /= len;

  // Ray until screen edge
  let t = Infinity;
  if (dx > 0) t = (canvas.width - wx) / dx;
  if (dx < 0) t = -wx / dx;
  if (dy > 0) t = Math.min(t, (canvas.height - wy) / dy);
  if (dy < 0) t = Math.min(t, -wy / dy);

  const hitX = wx + dx * t;
  const hitY = wy + dy * t;

  // Draw ray
  ctx.beginPath();
  ctx.moveTo(wx, wy);
  ctx.lineTo(hitX, hitY);
  ctx.strokeStyle = "lime";
  ctx.lineWidth = 4;
  ctx.stroke();

  // Impact
  ctx.beginPath();
  ctx.arc(hitX, hitY, 40, 0, Math.PI * 2);
  ctx.fillStyle = "red";
  ctx.fill();
}
</script>

</body>
</html>
