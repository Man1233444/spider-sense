<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Spider Sense VR</title>
<style>
body {
  margin: 0;
  background: black;
  color: white;
  font-size: 22px;
  text-align: center;
  overflow: hidden;
}
#status {
  position: absolute;
  top: 10px;
  width: 100%;
  text-align: center;
  z-index: 10;
}
#camera-container {
  display: flex;
  flex-direction: row;
}
video {
  width: 50%;
  height: auto;
}
</style>
</head>
<body>

<h1 id="status">Initializing VR Spider Sense...</h1>
<div id="camera-container">
  <video id="camera-left" autoplay playsinline></video>
  <video id="camera-right" autoplay playsinline></video>
</div>

<script>
const videoLeft = document.getElementById("camera-left");
const videoRight = document.getElementById("camera-right");
const statusText = document.getElementById("status");

// Request rear camera
navigator.mediaDevices.getUserMedia({ video: { facingMode: { exact: "environment" } } })
.then(stream => {
  videoLeft.srcObject = stream;
  videoRight.srcObject = stream;
  statusText.innerText = "Back camera active. VR Spider Sense running.";
  startDetection();
})
.catch(err => {
  statusText.innerText = "Back camera not available.";
});

let lastFrame = null;

function startDetection() {
  const canvas = document.createElement("canvas");
  const ctx = canvas.getContext("2d");

  setInterval(() => {
    if (videoLeft.videoWidth === 0) return;

    canvas.width = videoLeft.videoWidth;
    canvas.height = videoLeft.videoHeight;
    ctx.drawImage(videoLeft, 0, 0);

    const currentFrame = ctx.getImageData(0, 0, canvas.width, canvas.height);

    if (lastFrame) {
      let totalDiff = 0;
      // Sample pixels for speed
      for (let i = 0; i < currentFrame.data.length; i += 40) {
        totalDiff += Math.abs(currentFrame.data[i] - lastFrame.data[i]);
      }

      // Calculate vibration strength based on proximity
      if (totalDiff > 1000000) {
        let intensity = Math.min(Math.floor((totalDiff - 1000000) / 500000), 5);
        // Create vibration pattern: stronger = longer / more pulses
        let pattern = [];
        for (let i = 0; i < intensity; i++) {
          pattern.push(100, 50);
        }
        navigator.vibrate(pattern);

        const beep = new Audio("data:audio/wav;base64,UklGRigAAABXQVZFZm10IBAAAAABAAEAESsAACJWAAACABAAZGF0YQAAAAA=");
        beep.play();
      }
    }

    lastFrame = currentFrame;
  }, 250);
}
</script>

</body>
</html>
