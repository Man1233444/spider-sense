<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Spider Sense</title>
<style>
body {
  margin: 0;
  background: black;
  color: white;
  font-size: 24px;
  text-align: center;
}
video {
  width: 100%;
  height: auto;
}
</style>
</head>
<body>

<h1>Spider Sense Active</h1>
<p id="status">Starting camera...</p>
<video id="camera" autoplay playsinline></video>

<script>
const video = document.getElementById("camera");
const statusText = document.getElementById("status");

navigator.mediaDevices.getUserMedia({ video: true })
  .then(stream => {
    video.srcObject = stream;
    statusText.innerText = "Camera active. Listening for danger.";
    startDetection();
  })
  .catch(err => {
    statusText.innerText = "Camera access denied.";
  });

let lastFrame = null;

function startDetection() {
  const canvas = document.createElement("canvas");
  const ctx = canvas.getContext("2d");

  setInterval(() => {
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;
    ctx.drawImage(video, 0, 0);

    const currentFrame = ctx.getImageData(0, 0, canvas.width, canvas.height);

    if (lastFrame) {
      let diff = 0;
      for (let i = 0; i < currentFrame.data.length; i += 4) {
        diff += Math.abs(currentFrame.data[i] - lastFrame.data[i]);
      }

      if (diff > 5000000) {
        warnUser();
      }
    }

    lastFrame = currentFrame;
  }, 500);
}

function warnUser() {
  navigator.vibrate(200);

  const beep = new Audio("data:audio/wav;base64,UklGRigAAABXQVZFZm10IBAAAAABAAEAESsAACJWAAACABAAZGF0YQAAAAA=");
  beep.play();
}
</script>

</body>
</html>
